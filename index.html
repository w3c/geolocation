<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Geolocation API Specification
    </title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c" async class=
    "remove"></script>
    <script class="remove">
    var respecConfig = {
      shortName: "geolocation-API",
      mdn: "geolocation-api",
      specStatus: "ED",
      editors: [
        {
          name: "Devices and Sensors Working Group",
        },
      ],
      formerEditors: [
        {
          name: "Andrei Popescu",
          company: "Google Inc.",
          companyURL: "https://google.com/",
          w3cid: "36565",
        },
      ],
      group: "das",
      previousPublishDate: "2016-11-08",
      previousMaturity: "REC",
      github: "w3c/geolocation-api",
      caniuse: "geolocation",
      testSuiteURI: "https://web-platform-tests.live/geolocation-API/",
      // implementationReportURI: "https://wpt.fyi/geolocation-API",
      localBiblio: {
        WGS84: {
          title:
            "National Imagery and Mapping Agency Technical Report 8350.2, Third Edition",
          publisher: "National Imagery and Mapping Agency",
          date: "3 January 2000",
        },
      },
      xref: "web-platform",
    };
    </script>
  </head>
  <body data-cite="secure-contexts permissions-policy permissions">
    <section id="abstract">
      <p>
        This specification defines an API that provides scripted access to
        geographical location information associated with the hosting device.
      </p>
    </section>
    <section id="sotd">
      <p>
        The Devices and Sensors Working Group will maintain errata and new
        editions, as necessary, for the Geolocation API.
      </p>
    </section>
    <section id="introduction" class="informative">
      <h2>
        Introduction
      </h2>
      <p>
        The <cite>Geolocation API</cite> defines a high-level interface to
        location information associated only with the device hosting the
        implementation, such as latitude and longitude. The API itself is
        agnostic of the underlying location information sources. Common sources
        of location information include Global Positioning System (GPS) and
        location inferred from network signals such as IP address, RFID, WiFi
        and Bluetooth MAC addresses, and GSM/CDMA cell IDs, as well as user
        input. No guarantee is given that the API returns the device's actual
        location.
      </p>
    </section>
    <section>
      <h2>
        Examples
      </h2>
      <p>
        The API is designed to enable both "one-shot" position requests and
        repeated position updates, as well as the ability to explicitly query
        the cached positions. Location information is represented by latitude
        and longitude coordinates.
      </p>
      <p>
        The following examples illustrate how the API can be used in various
        common scenarios.
      </p>
      <section>
        <h3>
          "One-shot" position request
        </h3>
        <pre class="example js" title="A one-shot position request">
          navigator.geolocation.getCurrentPosition(position =&gt; {
            const { latitude, longitude } = position.coords;
            // Show a map centered at latitude / longitude.
          });
        </pre>
      </section>
      <section>
        <h3>
          Watching a position
        </h3>
        <aside class="example">
          <pre class="js" title="Watching a position for repeated updates">
            const watchId = navigator.geolocation.watchPosition(position =&gt; {
              const { latitude, longitude } = position.coords;
              // Show a map centered at latitude / longitude.
            });

            function buttonClickHandler() {
              // Cancel the updates when the user clicks a button.
              navigator.geolocation.clearWatch(watchId);
            }
          </pre>
          <p>
            And a HTML `button` that when pressed stops watching the position.
          </p>
          <pre class="html">
            &lt;button onclick="buttonClickHandler"&gt;
              Stop watching location
            &lt;/button&gt;
          </pre>
        </aside>
      </section>
      <section>
        <h3>
          Requesting position and handling errors
        </h3>
        <pre class="example js">
          // Request repeated updates.
          const watchId = navigator.geolocation.watchPosition(
            scrollMap, handleError
          );

          function scrollMap(position) {
            const { latitude, longitude } = position.coords;
            // Scroll map to latitude / longitude.
          }

          function handleError(error) {
            // Display error based on the error code.
            const { code } = error;
            switch (code) {
              case GeolocationPositionError.TIMEOUT:
                // Handle timeout
                break;
              case GeolocationPositionError.PERMISSION_DENIED:
                // User denied the request
                break;
              case POSITION_UNAVAILABLE:
                // Position not available
                break;
              default:
                // Anything else...
            }
          }
        </pre>
      </section>
      <section>
        <h3>
          Requesting a potentially cached position
        </h3>
        <pre class="example js">
          // Request a position. We accept positions whose age is not
          // greater than 10 minutes. If the user agent does not have a
          // fresh enough cached position object, it will automatically
          // acquire a new one.
          const options = {
            maximumAge: 600000,
          };
          navigator.geolocation.getCurrentPosition(
            successCallback, errorCallback, options
          );

          function successCallback(position) {
            // By using the 'maximumAge' option above, the position
            // object is guaranteed to be at most 10 minutes old.
          }

          function errorCallback(error) {
            // Display error based on the error code.
          }
        </pre>
      </section>
      <section>
        <h3>
          Getting a fresh position
        </h3>
        <pre class="example js" title="Using maximumAge option">
          // Request a position. We only accept cached positions whose age is not
          // greater than 10 minutes. If the user agent does not have a fresh
          // enough cached position object, it will immediately invoke the error
          // callback.
          const options = {
            maximumAge: 600000,
            timeout: 0,
          };

          navigator.geolocation.getCurrentPosition(
            successCallback, errorCallback, options
          );

          function successCallback(position) {
            // By using the 'maximumAge' option above, the position
            // object is guaranteed to be at most 10 minutes old.
            // By using a 'timeout' of 0 milliseconds, if there is
            // no suitable cached position available, the user agent
            // will asynchronously invoke the error callback with code
            // TIMEOUT and will not initiate a new position
            // acquisition process.
          }

          function errorCallback(error) {
            switch (error.code) {
              case GeolocationPositionError.TIMEOUT:
                // Quick fallback when no suitable cached position exists.
                doFallback();
                // Acquire a new position object.
                navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
                break;
              case ...: // treat the other error cases.
            }
          }

          function doFallback() {
            // No fresh enough cached position available.
            // Fallback to a default position.
          }
        </pre>
      </section>
      <section>
        <h3>
          Getting any available cached position
        </h3>
        <pre class="example js" title=
        "Force a cached response with timeout and maximumAge">
          // Request a position. We only accept cached positions, no matter what
          // their age is. If the user agent does not have a cached position at
          // all, it will immediately invoke the error callback.
          const options = {
            maximumAge: Infinity,
            timeout:0
          };
          navigator.geolocation.getCurrentPosition(
            successCallback, errorCallback, options
          );

          function successCallback(position) {
            // By setting the 'maximumAge' to Infinity, the position
            // object is guaranteed to be a cached one.
            // By using a 'timeout' of 0 milliseconds, if there is
            // no cached position available at all, the user agent
            // will immediately invoke the error callback with code
            // TIMEOUT and will not initiate a new position
            // acquisition process.
            if (position.timestamp &lt; freshness_threshold
                &amp;& position.coords.accuracy &lt; accuracy_threshold) {
              // The position is relatively fresh and accurate.
            } else {
              // The position is quite old and/or inaccurate.
            }
          }

          function errorCallback(error) {
            switch(error.code) {
              case GeolocationPositionError.TIMEOUT:
                // Quick fallback when no cached position exists at all.
                doFallback();
                // Acquire a new position object.
                navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
                break;
              case ... // treat the other error cases.
            };
          }

          function doFallback() {
            // No cached position available at all.
            // Fallback to a default position.
          }
        </pre>
      </section>
    </section>
    <section id="scope" class="informative">
      <h2>
        Scope
      </h2>
      <p>
        This specification is limited to providing a scripting API for
        retrieving geographic position information associated with a hosting
        device. The geographic position information is provided in terms of
        World Geodetic System coordinates [[WGS84]].
      </p>
      <p>
        The scope of this specification does not include providing a markup
        language of any kind.
      </p>
      <p>
        The scope of this specification does not include defining a new
        [=url/scheme=] for building URLs that identify geographic locations.
      </p>
    </section>
    <section id="security">
      <h2>
        Security and privacy considerations
      </h2>
      <p>
        The API defined in this specification is used to retrieve the
        geographic location of a hosting device. In almost all cases, this
        information also discloses the location of the user of the device,
        thereby potentially compromising the user's privacy.
      </p>
      <section id="privacy_for_recipients" class="informative">
        <h3>
          Privacy considerations for recipients of location information
        </h3>
        <p class="note" title=
        "Developers' responsibility with this sensitive data">
          This section applies to "recipients", which generally means
          developers utilizing the <cite>Geolocation API</cite>. Although it's
          impossible for user agent or specification to enforce these
          requirements, developers need to read this section carefully and do
          their best to adhere to the recommendations below. Developers also
          need to be aware of any privacy laws in their jurisdictions that
          govern the usage and access to location data.
        </p>
        <p>
          Recipients ought to only request location information when necessary,
          and only use the location information for the task for which it was
          provided to them. Recipients ought to dispose of location information
          once that task is completed, unless expressly permitted to retain it
          by the user. Recipients need to also take measures to protect this
          information against unauthorized access. If location information is
          stored, users need to be allowed to update and delete this
          information.
        </p>
        <p>
          The recipient of location information need to refrain from
          retransmitting the location information without the user’s express
          permission. Care needs to be taken when retransmitting and the use of
          encryption is encouraged.
        </p>
        <p>
          Recipients ought to clearly and conspicuously disclose the fact that
          they are collecting location data, the purpose for the collection,
          how long the data is retained, how the data is secured, how the data
          is shared if it is shared, how users can access, update and delete
          the data, and any other choices that users have with respect to the
          data. This disclosure needs to include an explanation of any
          exceptions to the guidelines listed above.
        </p>
      </section>
      <section id="implementation_considerations" class="informative">
        <h3>
          Additional implementation considerations
        </h3>
        <p>
          Further to the requirements listed in the previous section,
          implementers of the Geolocation API are also advised to consider the
          following aspects that can negatively affect the privacy of their
          users: in certain cases, users can inadvertently grant permission to
          the user agent to disclose their location to Web sites. In other
          cases, the content hosted at a certain URL changes in such a way that
          the previously granted location permissions no longer apply as far as
          the user is concerned. Or the users might simply change their minds.
        </p>
        <p>
          Predicting or preventing these situations is inherently difficult.
          Mitigation and in-depth defensive measures are an implementation
          responsibility and not prescribed by this specification. However, in
          designing these measures, implementers are advised to enable user
          awareness of location sharing, and to provide easy access to
          interfaces that enable revocation of permissions.
        </p>
      </section>
    </section>
    <section id="api_description">
      <h2>
        API Description
      </h2>
      <section id="navigator_interface" data-dfn-for="Navigator">
        <h3>
          `Navigator` interface extensions
        </h3>
        <pre class="idl">
          partial interface Navigator {
            [SameObject] readonly attribute Geolocation geolocation;
          };
        </pre>
        <section>
          <h3>
            `geolocation` attribute
          </h3>
          <p>
            The <dfn>geolocation</dfn> attribute gives access to location
            information associated with the hosting device.
          </p>
        </section>
      </section>
      <section id="geolocation_interface" data-dfn-for="Geolocation">
        <h3>
          `Geolocation` interface
        </h3>
        <p>
          The <dfn>Geolocation</dfn> interface is used by scripts to
          programmatically determine the location information associated with
          the hosting device. The location information is acquired by applying
          a user-agent specific algorithm, creating a {{GeolocationPosition}}
          object, and populating that object with appropriate data accordingly.
        </p>
        <pre class="idl">
        [Exposed=Window]
        interface Geolocation {
          undefined getCurrentPosition(PositionCallback successCallback,
                                  optional PositionErrorCallback? errorCallback = null,
                                  optional PositionOptions options = {});

          long watchPosition(PositionCallback successCallback,
                              optional PositionErrorCallback? errorCallback = null,
                              optional PositionOptions options = {});

          undefined clearWatch(long watchId);
        };

        callback PositionCallback = undefined (GeolocationPosition position);

        callback PositionErrorCallback = undefined (GeolocationPositionError positionError);
        </pre>
        <section>
          <h3>
            `getCurrentPosition()` method
          </h3>
          <p data-tests=
          "getCurrentPosition_IDL.https.html, getCurrentPosition_TypeError.html">
            When {{Geolocation/getCurrentPosition()}} is invoked, the user
            agent MUST:
          </p>
          <ol class="algorithm">
            <li>Return and continue [=in parallel=].
            </li>
            <li>If the <a>environment settings object</a> is a <a data-cite=
            "secure-contexts">non-secure context</a>, then [=call back with
            error=] |errorCallback| and
            {{GeolocationPositionError/PERMISSION_DENIED}} and terminate this
            algorithm.
            </li>
            <li>Let |permission:PermissionState| be [=request permission to
            use=] "geolocation".
            </li>
            <li data-cite="permissions" data-tests=
            "getCurrentPosition_permission_allow.https.html, getCurrentPosition_permission_deny.https.html">
            If |permission| is {{PermissionState/"denied"}}, then [=call back
            with error=] |errorCallback| and
            {{GeolocationPositionError/PERMISSION_DENIED}} and terminate this
            algorithm.
            </li>
            <li>If a cached {{GeolocationPosition}} object, whose age is no
            greater than the value of the {{PositionOptions/maximumAge}}
            variable, is available, invoke the |successCallback| with the
            cached {{GeolocationPosition}} object as a parameter and terminate
            this algorithm.
            </li>
            <li>If the value of the timeout variable is 0, [=call back with
            error=] |errorCallback| and {{GeolocationPositionError/TIMEOUT}}
            and terminate this algorithm.
            </li>
            <li>Start a location acquisition operation (e.g. by invoking a
            platform-specific API), possibly taking into account the value of
            the {{PositionOptions/enableHighAccuracy}} variable.
            </li>
            <li>Start a timer that will fire after the number of milliseconds
            denoted by the value of the timeout variable. When the timer fires,
            cancel any ongoing location acquisition operations associated with
            this instance of the steps, [=call back with error=]
            |errorCallback| and {{GeolocationPositionError/TIMEOUT}}.
            </li>
            <li>If the operation completes successfully before the timeout
            expires, cancel the pending timer, invoke the |successCallback|
            with a new {{GeolocationPosition}} object that reflects the result
            of the acquisition operation and terminate this algorithm.
            </li>
            <li>If the operation fails before the timeout expires, cancel the
            pending timer and [=call back with error=] |errorCallback| and
            {{GeolocationPositionError/POSITION_UNAVAILABLE}}.
            </li>
          </ol>
        </section>
        <section>
          <h3>
            `watchPosition()` method
          </h3>
          <p>
            When <dfn>watchPosition()</dfn> is invoked, the user agent MUST:
          </p>
          <ol class="algorithm">
            <li>Let |watchId:long| be {{long}} that uniquely identifies a
            <a>watch process</a>.
            </li>
            <li>Return |watchId| and continue [=in parallel=].
            </li>
            <li>If the <a>environment settings object</a> is a <a data-cite=
            "secure-contexts">non-secure context</a>, then [=call back with
            error=] |errorCallback| and
            {{GeolocationPositionError/PERMISSION_DENIED}} and terminate this
            algorithm.
            </li>
            <li>Let |permission:PermissionState| be [=request permission to
            use=] "geolocation".
            </li>
            <li data-tests=
            "getCurrentPosition_permission_allow.https.html, getCurrentPosition_permission_deny.https.html">
            If |permission| is {{PermissionState/"denied"}}, then [=call back
            with error=] |errorCallback| and
            {{GeolocationPositionError/PERMISSION_DENIED}} and terminate this
            algorithm.
            </li>
            <li>
              <p>
                Otherwise, start the watch operation. This operation MUST first
                attempt to obtain the current location of the device. If the
                attempt is successful, the |successCallback| MUST be invoked
                with a new {{GeolocationPosition}} object, reflecting the
                current location of the device. If the attempt fails, [=call
                back with error=], |errorCallback| and a {{unsigned short}}
                code that reflects the reason for the failure. The <a>watch
                process</a> then MUST continue to monitor the position of the
                device and invoke the appropriate callback every time this
                position changes. The <a>watch process</a> MUST continue until
                the {{Geolocation/clearWatch()}} method is called with the
                corresponding identifier.
              </p>
            </li>
          </ol>
          <p>
            The implementation of the <dfn>watch process</dfn> MUST execute the
            following set of steps:
          </p>
          <ol>
            <li>If a cached {{GeolocationPosition}} object, whose age is no
            greater than the value of the maximumAge variable, is available,
            invoke the |successCallback| with the cached
            {{GeolocationPosition}} object as a parameter.
            </li>
            <li>Register to receive system events that indicate that the
            position of the device MAY have changed (e.g. by listening or
            polling for changes in WiFi or cellular signals).
            </li>
            <li>Start a location acquisition operation (e.g. by invoking a
            platform-specific API), possibly taking into account the value of
            the |enableHighAccuracy| variable (see the definition of
            {{PositionOptions/enableHighAccuracy}} for details).
            </li>
            <li>Run the following <dfn>acquisition steps</dfn>:
              <ol>
                <li>If the timer is not already running, start a timer that
                will fire after the number of milliseconds denoted by the value
                of the timeout variable. When the timer fires, [=call back with
                error=] |errorCallback| and
                {{GeolocationPositionError/TIMEOUT}} and jump to the <a>wait
                for a system event to be received</a> step.
                </li>
                <li>If the location acquisition operation successfully yields a
                new position before the timeout expires, perform the following
                two steps:
                  <ol>
                    <li>Cancel the pending timer. Note that the timer MUST be
                    restarted once this algorithm jumps back to the beginning
                    of the acquisition steps.
                    </li>
                    <li>If the <dfn>new position differs significantly from the
                    previous position</dfn>, invoke the |successCallback| with
                    a new {{GeolocationPosition}} object that reflects the
                    result of the acquisition operation. This step MAY be
                    subject to callback [=rate limitation=].
                    </li>
                  </ol>
                </li>
                <li>Else, if the location acquisition operation reports an
                error before the {{PositionOptions/timeout}} expires, [=call
                back with error=] |errorCallback| and
                {{GeolocationPositionError/POSITION_UNAVAILABLE}}. This step
                MAY be subject to callback [=rate limitation=].
                </li>
              </ol>
            </li>
            <li>
              <dfn>Wait for a system event to be received</dfn>. When such an
              event is received jump to the <a>acquisition steps</a> above.
            </li>
          </ol>
          <p class="note">
            If the <a>new position differs significantly from the previous
            position</a> in the <a>watch process</a>, the |successCallback| is
            only invoked when a new position is obtained and this position
            differs significantly from the previously reported position. The
            definition of what constitutes a significant difference is left to
            the implementation. Furthermore, in steps 4.2.2 and 4.3,
            implementations MAY impose a <dfn data-lt="rate limitation">rate
            limit</dfn> on the frequency of callbacks so as to avoid
            inadvertently consuming a disproportionate amount of resources.
          </p>
          <p>
            The time that is spent obtaining the user permission MUST NOT be
            included in the period covered by the {{PositionOptions/timeout}}
            attribute of the {{PositionOptions}} parameter. The
            {{PositionOptions/timeout}} attribute MUST only apply to the
            location acquisition operation.
          </p>
        </section>
        <section>
          <h3>
            `clearWatch()` method
          </h3>
          <p data-tests="clearWatch_TypeError.html">
            The <dfn>clearWatch()</dfn> method takes one argument. When called,
            it MUST first check the value of the given <dfn>watchId</dfn>
            argument. If this value does not correspond to any previously
            started <a>watch process</a>, then the method MUST return
            immediately without taking any further action. Otherwise, the
            <a>watch process</a> identified by the `watchId` argument MUST be
            immediately stopped and no further callbacks MUST be invoked.
          </p>
        </section>
        <section>
          <h3>
            Callback with error
          </h3>
          <p>
            When instructed to <dfn>call back with error</dfn>, given an
            {{PositionErrorCallback}}? |callback:PositionErrorCallback?| and
            {{unsigned short}} |code:unsigned short|:
          </p>
          <ol class="algorithm">
            <li>If |callback| is null, return.
            </li>
            <li>Let |error| be a a newly created {{GeolocationPositionError}}
            object whose {{GeolocationPositionError/code}} attribute is
            initialized to |code|.
            </li>
            <li>Call |callback| with |error|.
            </li>
          </ol>
        </section>
        <section data-dfn-for="PositionCallBack">
          <h3>
            `PositionCallBack` callback
          </h3>
          <p>
            The <dfn>PositionCallBack</dfn> callback is invoked when a
            {{GeolocationPosition}} object is available, resulting from a
            cached object or the acquisition operation. The
            <a>PositionCallBack</a> callback gets set using the
            <dfn>successCallback</dfn> parameter.
          </p>
        </section>
        <section data-dfn-for="PositionErrorCallBack">
          <h3>
            `PositionErrorCallBack` callback
          </h3>
          <p>
            The <dfn>PositionErrorCallBack</dfn> callback is invoked when a
            {{GeolocationPosition}} object is not available, resulting from a
            timeout, a permission denied, or an unability to determine the
            position of the device. The <a>PositionErrorCallBack</a> callback
            gets set using the <dfn>errorCallback</dfn> parameter.
          </p>
        </section>
      </section>
      <section id="position_options_interface" data-dfn-for="PositionOptions">
        <h3>
          <dfn>PositionOptions</dfn> dictionary
        </h3>
        <p>
          The {{Geolocation/getCurrentPosition()}} and
          {{Geolocation/watchPosition()}} methods accept {{PositionOptions}}
          objects as their third argument.
        </p>
        <p>
          In ECMAScript, {{PositionOptions}} objects are represented using
          regular native objects with optional properties named
          {{PositionOptions/enableHighAccuracy}}, {{PositionOptions/timeout}}
          and {{PositionOptions/maximumAge}}.
        </p>
        <pre class="idl">
        dictionary PositionOptions {
          boolean enableHighAccuracy = false;
          [Clamp] unsigned long timeout = 0xFFFFFFFF;
          [Clamp] unsigned long maximumAge = 0;
        };
        </pre>
        <section>
          <h3>
            `enableHighAccuracy` member
          </h3>
          <p data-tests="PositionOptions.https.html">
            The <dfn>enableHighAccuracy</dfn> attribute provides a hint that
            the application would like to receive the best possible results.
            This MAY result in slower response times or increased power
            consumption. The user might also deny this capability, or the
            device might not be able to provide more accurate results than if
            the flag wasn't specified. The intended purpose of this attribute
            is to allow applications to inform the implementation that they do
            not require high accuracy geolocation fixes and, therefore, the
            implementation can avoid using geolocation providers that consume a
            significant amount of power (e.g. GPS). This is especially useful
            for applications running on battery-powered devices, such as mobile
            phones.
          </p>
        </section>
        <section>
          <h3>
            `timeout` member
          </h3>
          <p data-tests="PositionOptions.https.html">
            The <dfn>timeout</dfn> attribute denotes the maximum length of time
            (expressed in milliseconds) that is allowed to pass from the call
            to {{Geolocation/getCurrentPosition()}} or
            {{Geolocation/watchPosition()}} until the corresponding
            |successCallback| is invoked. If the implementation is unable to
            successfully acquire a new {{GeolocationPosition}} before the given
            timeout elapses, and no other errors have occurred in this
            interval, then the corresponding |errorCallback| MUST be invoked
            with a {{GeolocationPositionError}} object whose code attribute is
            set to {{GeolocationPositionError/TIMEOUT}}. Note that the time
            that is spent obtaining the user permission is not included in the
            period covered by the {{PositionOptions/timeout}} attribute. The
            {{PositionOptions/timeout}} attribute only applies to the location
            acquisition operation.
          </p>
          <p>
            In case of a {{Geolocation/getCurrentPosition()}} call, the
            |errorCallback| would be invoked at most once.
          </p>
          <p>
            In case of a {{Geolocation/watchPosition()}}, the |errorCallback|
            could be invoked repeatedly: the first timeout is relative to the
            moment {{Geolocation/watchPosition()}} was called or the moment the
            user's permission was obtained, if that was necessary. Subsequent
            timeouts are relative to the moment when the implementation
            determines that the position of the hosting device has changed and
            a new {{GeolocationPosition}} object MUST be acquired.
          </p>
        </section>
        <section>
          <h3>
            `maximumAge` member
          </h3>
          <p data-tests="PositionOptions.https.html">
            The <dfn>maximumAge</dfn> attribute indicates that the application
            is willing to accept a cached position whose age is no greater than
            the specified time in milliseconds. If
            {{PositionOptions/maximumAge}} is set to 0, the implementation MUST
            immediately attempt to acquire a new position object. Setting the
            {{PositionOptions/maximumAge}} to `Infinity` MUST determine the
            implementation to return a cached position regardless of its age.
            If an implementation does not have a cached position available
            whose age is no greater than the specified
            {{PositionOptions/maximumAge}}, then it MUST acquire a new
            {{GeolocationPosition}} object. In case of a
            {{Geolocation/watchPosition()}}, the {{PositionOptions/maximumAge}}
            refers to the first {{GeolocationPosition}} object returned by the
            implementation.
          </p>
        </section>
      </section>
      <section id="position_interface" data-dfn-for="GeolocationPosition">
        <h3>
          `GeolocationPosition` interface
        </h3>
        <pre class="idl">
          [Exposed=Window, SecureContext]
          interface GeolocationPosition {
            readonly attribute GeolocationCoordinates coords;
            readonly attribute DOMTimeStamp timestamp;
          };
        </pre>
        <p>
          The <dfn>GeolocationPosition</dfn> interface is the container for the
          geolocation information returned by this API. This version of the
          specification allows one attribute of type {{GeolocationCoordinates}}
          and a {{GeolocationPosition/timestamp}}. Future versions of the API
          MAY allow additional attributes that provide other information about
          this position (e.g. street addresses).
        </p>
        <section>
          <h4>
            `coords` attribute
          </h4>
          <p>
            The <dfn>coords</dfn> attribute contains a set of geographic
            coordinates together with their associated accuracy, as well as a
            set of other optional attributes such as altitude and speed.
          </p>
        </section>
        <section>
          <h4>
            `timestamp` attribute
          </h4>
          <p>
            The <dfn>timestamp</dfn> attribute represents the time when the
            {{GeolocationPosition}} object was acquired and is represented as a
            {{DOMTimeStamp}}.
          </p>
        </section>
      </section>
      <section id="coordinates_interface" data-dfn-for=
      "GeolocationCoordinates">
        <h3>
          <dfn>GeolocationCoordinates</dfn> interface
        </h3>
        <pre class="idl">
        [Exposed=Window, SecureContext]
        interface GeolocationCoordinates {
          readonly attribute double latitude;
          readonly attribute double longitude;
          readonly attribute double? altitude;
          readonly attribute double accuracy;
          readonly attribute double? altitudeAccuracy;
          readonly attribute double? heading;
          readonly attribute double? speed;
        };
        </pre>
        <p>
          The geographic coordinate reference system used by the attributes in
          this interface is the World Geodetic System (2d) [[WGS84]]. No other
          reference system is supported.
        </p>
        <section>
          <h4>
            `latitude` attribute
          </h4>
          <p>
            The <dfn>latitude</dfn> and <dfn>longitude</dfn> attributes are
            geographic coordinates specified in decimal degrees.
          </p>
        </section>
        <section>
          <h4>
            `altitude` attribute
          </h4>
          <p>
            The <dfn>altitude</dfn> attribute denotes the height of the
            position, specified in meters above the [[WGS84]] ellipsoid. If the
            implementation cannot provide altitude information, the value of
            this attribute MUST be null.
          </p>
        </section>
        <section>
          <h4>
            `accuracy` attribute
          </h4>
          <p>
            The <dfn>accuracy</dfn> attribute denotes the accuracy level of the
            latitude and longitude coordinates. It is specified in meters and
            MUST be supported by all implementations. The value of the accuracy
            attribute MUST be a non-negative real number.
          </p>
        </section>
        <section>
          <h4>
            `altitudeAccuracy` attribute
          </h4>
          <p>
            The <dfn>altitudeAccuracy</dfn> attribute is specified in meters.
            If the implementation cannot provide altitude information, the
            value of this attribute MUST be null. Otherwise, the value of the
            altitudeAccuracy attribute MUST be a non-negative real number.
          </p>
          <p>
            The {{GeolocationCoordinates/accuracy}} and
            {{GeolocationCoordinates/altitudeAccuracy}} values returned by an
            implementation SHOULD correspond to a 95% confidence level.
          </p>
        </section>
        <section>
          <h4>
            `heading` attribute
          </h4>
          <p>
            The <dfn>heading</dfn> attribute denotes the direction of travel of
            the hosting device and is specified in degrees, where 0° ≤ heading
            &lt; 360°, counting clockwise relative to the true north. If the
            implementation cannot provide heading information, the value of
            this attribute MUST be null. If the hosting device is stationary
            (i.e. the value of the {{GeolocationCoordinates/speed}} attribute
            is 0), then the value of the heading attribute MUST be NaN.
          </p>
        </section>
        <section>
          <h4>
            `speed` attribute
          </h4>
          <p>
            The <dfn>speed</dfn> attribute denotes the magnitude of the
            horizontal component of the hosting device's current velocity and
            is specified in meters per second. If the implementation cannot
            provide speed information, the value of this attribute MUST be
            null. Otherwise, the value of the speed attribute MUST be a
            non-negative real number.
          </p>
        </section>
      </section>
      <section id="position_error_interface" data-dfn-for=
      "GeolocationPositionError">
        <h3>
          <dfn>GeolocationPositionError</dfn> interface
        </h3>
        <pre class="idl">
        [Exposed=Window]
        interface GeolocationPositionError {
          const unsigned short PERMISSION_DENIED = 1;
          const unsigned short POSITION_UNAVAILABLE = 2;
          const unsigned short TIMEOUT = 3;
          readonly attribute unsigned short code;
          readonly attribute DOMString message;
        };
        </pre>
        <section>
          <h4>
            `code` attribute
          </h4>
          <p>
            The <dfn>code</dfn> attribute MUST return the appropriate code from
            the following list:
          </p>
          <dl>
            <dt>
              <dfn>PERMISSION_DENIED</dfn> (numeric value 1)
            </dt>
            <dd>
              The location acquisition process failed because the document does
              not have permission to use the Geolocation API.
            </dd>
            <dt>
              <dfn>POSITION_UNAVAILABLE</dfn> (numeric value 2)
            </dt>
            <dd>
              The position of the device could not be determined. For instance,
              one or more of the location providers used in the location
              acquisition process reported an internal error that caused the
              process to fail entirely.
            </dd>
            <dt>
              <dfn>TIMEOUT</dfn> (numeric value 3)
            </dt>
            <dd>
              The length of time specified by the {{PositionOptions/timeout}}
              property has elapsed before the implementation could successfully
              acquire a new {{GeolocationPosition}} object.
            </dd>
          </dl>
        </section>
        <section>
          <h4>
            `message` attribute
          </h4>
          <p>
            The <dfn>message</dfn> attribute is a developer-friendly textual
            description of the {{GeolocationPositionError/code}} attribute.
          </p>
          <p class="note">
            The purpose of the {{GeolocationPositionError/message}} attribute
            is to assist with debugging and it's not intended to be shown to
            end users.
          </p>
        </section>
      </section>
    </section>
    <section>
      <h2>
        Permissions policy
      </h2>
      <p>
        The <cite>Geolocation API</cite> defines a [=policy-controlled
        feature=] identified by the string "geolocation". Its [=default
        allowlist=] is `["self"]`.
      </p>
      <aside class="note">
        <p>
          The <a>default allowlist</a> of `["self"]` allows Geolocation usage
          in same-origin nested frames but prevents third-party content from
          using the API.
        </p>
        <p>
          Third-party usage can be selectively enabled by adding
          `allow="geolocation"` attribute to an [^iframe^] element:
        </p>
        <pre class="example html" title=
        "Enabling Geolocation on third-party content">
          &lt;iframe src="https://third-party.com" allow="geolocation"/&gt;&lt;/iframe&gt;
        </pre>
        <p>
          Alternatively, the Geolocation API can be disabled completely in a
          first-party context by specifying the permission policy in a HTTP
          response header:
        </p>
        <pre class="example http" title="Feature Policy over HTTP">
          Permissions-Policy: geolocation 'none'
        </pre>
        <p>
          See [[[permissions-policy]]] for more details.
        </p>
      </aside>
    </section>
    <section id="usecases" class="informative">
      <h2>
        Use-Cases and Requirements
      </h2>
      <section id="usecases_section">
        <h3>
          Use-Cases
        </h3>
        <section id="usecase_find_poi">
          <h4>
            Find points of interest in the user's area
          </h4>
          <p>
            Someone visiting a foreign city could access a Web application that
            allows users to search or browse through a database of tourist
            attractions. Using the Geolocation API, the Web application has
            access to the user's approximate position and it is therefore able
            to rank the search results by proximity to the user's location.
          </p>
        </section>
        <section id="usecase_content_annotation">
          <h4>
            Annotating content with location information
          </h4>
          <p>
            A group of friends is hiking through the Scottish highlands. Some
            of them write short notes and take pictures at various points
            throughout the journey and store them using a Web application that
            can work offline on their hand-held devices. Whenever they add new
            content, the application automatically tags it with location data
            from the Geolocation API (which, in turn, uses the on-board GPS
            device). Every time they reach a town or a village, and they are
            again within network coverage, the application automatically
            uploads their notes and pictures to a popular blogging Web site,
            which uses the geolocation data to construct links that point to a
            mapping service. Users who follow the group's trip can click on
            these links to see a satellite view of the area where the notes
            were written and the pictures were taken. Another example is a life
            blog where a user creates content (e.g. images, video, audio) that
            records her every day experiences. This content can be
            automatically annotated with information such as time, geographic
            position or even the user's emotional state at the time of the
            recording.
          </p>
        </section>
        <section id="usecase_show_position">
          <h4>
            Show the user's position on a map
          </h4>
          <p>
            A user finds herself in an unfamiliar city area. She wants to check
            her position so she uses her hand-held device to navigate to a
            Web-based mapping application that can pinpoint her exact location
            on the city map using the Geolocation API. She then asks the Web
            application to provide driving directions from her current position
            to her desired destination.
          </p>
        </section>
        <section id="usecase_turn_by_turn">
          <h4>
            Turn-by-turn route navigation
          </h4>
          <p>
            A mapping application can help the user navigate along a route by
            providing detailed turn-by-turn directions. The application does
            this by registering with the Geolocation API to receive repeated
            location updates of the user's position. These updates are
            delivered as soon as the implementing user agent determines that
            the position of the user has changed, which allows the application
            to anticipate any changes of direction that the user might need to
            do.
          </p>
        </section>
        <section id="usecase_poi_alert">
          <h4>
            Alerts when points of interest are in the user's vicinity
          </h4>
          <p>
            A tour-guide Web application can use the Geolocation API to monitor
            the user's position and trigger visual or audio notifications when
            interesting places are in the vicinity. An online task management
            system can trigger reminders when the user is in the proximity of
            landmarks that are associated with certain tasks.
          </p>
        </section>
        <section id="usecase_local_info">
          <h4>
            Up-to-date local information
          </h4>
          <p>
            A widget-like Web application that shows the weather or news that
            are relevant to the user's current area can use the Geolocation API
            to register for location updates. If the user's position changes,
            the widget can adapt the content accordingly.
          </p>
        </section>
        <section id="usecase_social_networking">
          <h4>
            Location-tagged status updates in social networking applications
          </h4>
          <p>
            A social network application allows its users to automatically tag
            their status updates with location information. It does this by
            monitoring the user's position with the Geolocation API. Each user
            can control the granularity of the location information (e.g. city
            or neighborhood level) that is shared with the other users. Any
            user can also track his network of friends and get real-time
            updates about their current location.
          </p>
        </section>
      </section>
      <section id="requirements_section" class="informative">
        <h3>
          Requirements
        </h3>
        <ol>
          <li id="req_latlong">The Geolocation API needs to provide location
          data in terms of a pair of latitude and longitude coordinates.
          </li>
          <li id="req_accuracy">The Geolocation API needs to provide
          information about the accuracy of the retrieved location data.
          </li>
          <li id="req_oneshot">The Geolocation API needs to support "one-shot"
          position updates.
          </li>
          <li id="req_updates">The Geolocation API needs to allow an
          application to register to receive updates when the position of the
          hosting device changes.
          </li>
          <li id="req_last_known">The Geolocation API needs to allow an
          application to request a cached position whose age is no greater than
          a specified value.
          </li>
          <li id="req_errors">The Geolocation API needs to provide a way for
          the application to receive updates about errors that have occurred
          while obtaining a location fix.
          </li>
          <li id="req_request_acuracy">The Geolocation API needs to allow an
          application to specify a desired accuracy level of the location
          information.
          </li>
          <li id="req_source_agnostic">The Geolocation API needs to be agnostic
          to the underlying sources of location information.
          </li>
        </ol>
      </section>
    </section>
    <section id="conformance">
      <p id="hardwareLimitations">
        User agents MAY impose implementation-specific limits on otherwise
        unconstrained inputs, e.g. to prevent denial of service attacks, to
        guard against running out of memory, or to work around
        platform-specific limitations.
      </p>
    </section>
    <section id="idl-index" class="appendix">
      <!-- All the Web IDL will magically appear here -->
    </section>
    <section id="index"></section>
    <section class="appendix informative">
      <h2>
        Acknowledgments
      </h2>
      <p>
        The Geolocation API in this specification builds upon earlier work in
        the industry, including research by Aza Raskin, the Gears Geolocation
        API, and LocationAware.org.
      </p>
      <p>
        Alec Berntson, Alissa Cooper, Steve Block, Greg Bolsinga, Lars Erik
        Bolstad, Aaron Boodman, Dave Burke, Chris Butler, Max Froumentin, Shyam
        Habarakada, Marcin Hanclik, Ian Hickson, Brad Lassey, Angel Machin,
        Cameron McCormack, Daniel Park, Stuart Parmenter, Olli Pettay, Chris
        Prince, Arun Ranganathan, Aza Raskin, Carl Reed, Thomas Roessler, Dirk
        Segers, Allan Thomson, Martin Thomson, Doug Turner, Erik Wilde, Matt
        Womer, and Mohamed Zergaoui.
      </p>
    </section>
  </body>
</html>
