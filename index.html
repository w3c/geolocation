<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Geolocation API
    </title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c" async class=
    "remove"></script>
    <script class="remove">
    var respecConfig = {
      shortName: "geolocation-API",
      mdn: "geolocation-api",
      specStatus: "ED",
      editors: [
        {
          name: "Marcos Cáceres",
          company: "W3C",
          companyURL: "https://w3.org",
          w3cid: 39125,
        },
      ],
      formerEditors: [
        {
          name: "Andrei Popescu",
          company: "Google Inc.",
          companyURL: "https://google.com/",
          w3cid: "36565",
        },
      ],
      group: "das",
      previousPublishDate: "2016-11-08",
      previousMaturity: "REC",
      github: "w3c/geolocation-api",
      caniuse: "geolocation",
      testSuiteURI: "https://web-platform-tests.live/geolocation-API/",
      // implementationReportURI: "https://wpt.fyi/geolocation-API",
      localBiblio: {
        WGS84: {
          title:
            "National Imagery and Mapping Agency Technical Report 8350.2, Third Edition",
          publisher: "National Imagery and Mapping Agency",
          date: "3 January 2000",
        },
      },
      xref: "web-platform",
    };
    </script>
  </head>
  <body data-cite="secure-contexts permissions-policy permissions">
    <section id="abstract">
      <p>
        This specification defines an API that provides scripted access to
        geographical location information associated with the hosting device.
      </p>
    </section>
    <section id="sotd">
      <p>
        The Devices and Sensors Working Group is updating this specification in
        the hope of making it a "living standard". As such, we've dropped the
        "Editions" and aim to continue publishing updated W3C Recommendations
        of this specification as we add new features or fix bugs.
      </p>
    </section>
    <section id="introduction" class="informative">
      <h2>
        Introduction
      </h2>
      <p>
        The <cite>Geolocation API</cite> defines a high-level interface to
        location information associated only with the device hosting the
        implementation, such as latitude and longitude. Common sources of
        location information include Global Positioning System (GPS) and
        location inferred from network signals such as IP address, RFID, WiFi
        and Bluetooth MAC addresses, and GSM/CDMA cell IDs, as well as user
        input. The API itself is agnostic of the underlying location
        information sources, and no guarantee is given that the API returns the
        device's actual location.
      </p>
      <p>
        For developers, the Geolocation API:
      </p>
      <ul>
        <li>Provides location data in terms of a pair of latitude and longitude
        coordinates, and given an indication of the accuracy of the retrieved
        location data.
        </li>
        <li>Supports "one-shot" position updates.
        </li>
        <li>Allows an application to register to receive updates when the
        position of the hosting device changes.
        </li>
        <li>Allows an application to request a cached position whose age is no
        greater than a specified value.
        </li>
        <li>Provides a way for the application to receive updates about errors
        that have occurred while obtaining a location fix.
        </li>
        <li>Allows an application to specify a desired accuracy level of the
        location information.
        </li>
      </ul>
      <section id="scope" class="informative">
        <h3>
          Scope
        </h3>
        <p>
          This specification is limited to providing a scripting API for
          retrieving geographic position information associated with a hosting
          device. The geographic position information is provided in terms of
          World Geodetic System coordinates [[WGS84]]. It does not include
          providing a markup language of any kind, nor does not include
          defining a new URL scheme for building URLs that identify geographic
          locations.
        </p>
      </section>
      <section>
        <h2>
          Changes since last publication
        </h2>
        <p>
          Since publication of the Second Edition in 2016, this specification
          has undergone the following changes:
        </p>
        <ul>
          <li>Geolocation updates only occur when a document is visible, or the
          document becomes visible.
          </li>
          <li>Depend on the [[[Permissions]]] specification to handle
          permission grants.
          </li>
          <li>The `errorCallback` can now be set to `null`.
          </li>
          <li>The API can be controlled by [[[Permissions-Policy]]], which
          restricts how/where the API is exposed to web pages.
          </li>
          <li>The `callbacks` are no longer treated as "EventHandler" objects
          (i.e., objects that have a `.handleEvent()` method), but are now
          always treated as proper callback functions in JavaScript.
          </li>
          <li>The API is now only exposed in Secure Contexts (i.e., only
          available in HTTPS).
          </li>
          <li>The interfaces no longer use [[WebIDL]]'s legacy
          `[NoInterfaceObject]`, so `Geolocation` and other interface of this
          spec are now in the global scope. Also, the interfaces were renamed
          from `NavigatorGeolocation*` to just `Geolocation*`.
          </li>
        </ul>
        <p>
          See the <a href=
          "https://github.com/w3c/geolocation-api/commits/gh-pages">commit
          history</a> for a complete list of changes.
        </p>
      </section>
    </section>
    <section>
      <h2>
        Examples
      </h2>
      <p>
        The API is designed to enable both "one-shot" position requests and
        repeated position updates, as well as the ability to explicitly query
        the cached positions. Location information is represented by latitude
        and longitude coordinates.
      </p>
      <p>
        The following examples illustrate how the API can be used in various
        common scenarios.
      </p>
      <section>
        <h3>
          "One-shot" position request
        </h3>
        <aside class="example" title="A one-shot position request">
          <pre class="js">
            navigator.geolocation.getCurrentPosition(position =&gt; {
              const { latitude, longitude } = position.coords;
              // Show a map centered at latitude / longitude.
            });
          </pre>
        </aside>
      </section>
      <section>
        <h3>
          Watching a position
        </h3>
        <aside class="example" title=
        "Watching a position for repeated updates">
          <pre class="js">
            const watchId = navigator.geolocation.watchPosition(position =&gt; {
              const { latitude, longitude } = position.coords;
              // Show a map centered at latitude / longitude.
            });

            function buttonClickHandler() {
              // Cancel the updates when the user clicks a button.
              navigator.geolocation.clearWatch(watchId);
            }
          </pre>
          <p>
            And a HTML `button` that when pressed stops watching the position.
          </p>
          <pre class="html">
            &lt;button onclick="buttonClickHandler()"&gt;
              Stop watching location
            &lt;/button&gt;
          </pre>
        </aside>
      </section>
      <section>
        <h3>
          Handling errors
        </h3>
        <aside class="example" title="Handling errors">
          <pre class="js">
            // Request repeated updates.
            const watchId = navigator.geolocation.watchPosition(
              scrollMap, handleError
            );

            function scrollMap(position) {
              const { latitude, longitude } = position.coords;
              // Scroll map to latitude / longitude.
            }

            function handleError(error) {
              // Display error based on the error code.
              const { code } = error;
              switch (code) {
                case GeolocationPositionError.TIMEOUT:
                  // Handle timeout.
                  break;
                case GeolocationPositionError.PERMISSION_DENIED:
                  // User denied the request.
                  break;
                case POSITION_UNAVAILABLE:
                  // Position not available.
                  break;
                default:
                  // Anything else...
              }
            }
          </pre>
        </aside>
      </section>
      <section>
        <h3>
          Requesting a potentially cached position
        </h3>
        <aside class="example" title="Getting cached position">
          <pre class="js">
            // Request a position. We accept positions whose age
            // is not greater than 10 minutes. If the user agent
            // does not have a fresh enough cached position object,
            // it will automatically acquire a new position.
            navigator.geolocation.getCurrentPosition(
              successCallback,
              errorCallback,
              { maximumAge: 600000 }
            );

            function successCallback(position) {
              // By using the 'maximumAge' member above, the position
              // object is guaranteed to be at most 10 minutes old.
            }

            function errorCallback(error) {
              // Display error based on the error code.
            }
          </pre>
        </aside>
      </section>
      <section>
        <h3>
          Getting a fresh position
        </h3>
        <aside class="example" title="Using maximumAge option">
          <pre class="js">
            // Request a position. We only accept cached positions whose age
            // is not greater than 10 minutes. If the user agent does not
            // have a fresh enough cached position object, it will immediately
            // invoke the error callback.
            const options = {
              maximumAge: 600000,
              timeout: 0,
            };

            navigator.geolocation.getCurrentPosition(
              successCallback,
              errorCallback,
              options
            );

            function successCallback(position) {
              // By using the 'maximumAge' member above, the position
              // object is guaranteed to be at most 10 minutes old.
              // By using a 'timeout' of 0 milliseconds, if there is
              // no suitable cached position available, the user agent
              // will asynchronously invoke the error callback with code
              // TIMEOUT and will not initiate a new position
              // acquisition process.
            }

            function errorCallback(error) {
              switch (error.code) {
                case GeolocationPositionError.TIMEOUT:
                  // Quick fallback when no suitable cached position exists.
                  doFallback();
                  // Acquire a new position object.
                  navigator.geolocation.getCurrentPosition(
                    successCallback, errorCallback
                  );
                  break;
                case "...": // treat the other error cases.
              }
            }

            function doFallback() {
              // No fresh enough cached position available.
              // Fallback to a default position.
            }
          </pre>
        </aside>
      </section>
      <section>
        <h3>
          Getting any available cached position
        </h3>
        <aside class="example js" title=
        "Force a cached response with timeout and maximumAge">
          <pre class="js">
          // Request a position. We only accept cached positions,
          // no matter what their age is. If the user agent does
          // not have a cached position at all, it will immediately
          // invoke the error callback.
          const options = {
            maximumAge: Infinity,
            timeout: 0,
          };
          navigator.geolocation.getCurrentPosition(
            successCallback,
            errorCallback,
            options
          );

          function successCallback(position) {
            // By setting the 'maximumAge' to Infinity, the position
            // object is guaranteed to be a cached one.
            // By using a 'timeout' of 0 milliseconds, if there is
            // no cached position available at all, the user agent
            // will immediately invoke the error callback with code
            // TIMEOUT and will not initiate a new position
            // acquisition process.
            if (
              position.timestamp &lt; freshness_threshold &amp;&
              position.coords.accuracy &lt; accuracy_threshold
            ) {
              // The position is relatively fresh and accurate.
            } else {
              // The position is quite old and/or inaccurate.
            }
          }

          function errorCallback(error) {
            switch (error.code) {
              case GeolocationPositionError.TIMEOUT:
                // Quick fallback when no cached position exists at all.
                doFallback();
                // Acquire a new position object.
                navigator.geolocation.getCurrentPosition(
                  successCallback, errorCallback
                );
                break;
              case "...": // treat the other error cases.
            }
          }

          function doFallback() {
            // No cached position available at all.
            // Fallback to a default position.
          }
          </pre>
        </aside>
      </section>
      <section>
        <h3>
          Enabling the API in third-party contexts
        </h3>
        <p>
          The <a>default allowlist</a> of `["self"]` allows Geolocation usage
          in same-origin nested frames but prevents third-party content from
          using the API.
        </p>
        <p>
          Third-party usage can be selectively enabled by adding
          [^iframe/allow^]="geolocation"` attribute to an [^iframe^] element:
        </p>
        <aside class="example" title=
        "Enabling the Geolocation API in an iframe">
          <pre class="html">
            &lt;iframe
              src="https://third-party.com"
              allow="geolocation"&gt;
            &lt;/iframe&gt;
          </pre>
        </aside>
        <p>
          Alternatively, the Geolocation API can be disabled in a first-party
          context by specifying the a HTTP response header:
        </p>
        <aside class="example" title="Permissions Policy over HTTP">
          <pre class="http">
            Permissions-Policy: geolocation 'none'
          </pre>
        </aside>
        <p>
          See [[[permissions-policy]]] for more details about the
          `Permissions-Policy` HTTP header.
        </p>
      </section>
    </section>
    <section id="security" class="informative">
      <h2>
        Privacy and security considerations
      </h2>
      <p>
        The API defined in this specification is used to retrieve the
        geographic location of a hosting device. In almost all cases, this
        information also discloses the location of the user of the device,
        thereby potentially compromising the user's privacy.
      </p>
      <section id="privacy_for_recipients" class="informative">
        <h3>
          Privacy considerations for recipients of location information
        </h3>
        <p class="note" title=
        "Developers' responsibility with this sensitive data">
          This section applies to "recipients", which generally means
          developers utilizing the <cite>Geolocation API</cite>. Although it's
          impossible for user agent, or this specification, to enforce these
          requirements, developers need to read this section carefully and do
          their best to adhere to the recommendations below. Developers need to
          be aware that there might be privacy laws in their jurisdictions that
          can govern the usage and access to user's location data.
        </p>
        <p>
          Recipients ought to only request position information when necessary,
          and only use the location information for the task for which it was
          provided to them. Recipients ought to dispose of location information
          once that task is completed, unless expressly permitted to retain it
          by the user. Recipients need to also take measures to protect this
          information against unauthorized access. If location information is
          stored, users need to be allowed to update and delete this
          information.
        </p>
        <p>
          The recipient of location information need to refrain from
          retransmitting the location information without the user’s express
          permission. Care needs to be taken when retransmitting and the use of
          encryption is encouraged.
        </p>
        <p>
          Recipients ought to clearly and conspicuously disclose the fact that
          they are collecting location data, the purpose for the collection,
          how long the data is retained, how the data is secured, how the data
          is shared if it is shared, how users can access, update and delete
          the data, and any other choices that users have with respect to the
          data. This disclosure needs to include an explanation of any
          exceptions to the guidelines listed above.
        </p>
      </section>
      <section id="implementation_considerations" class="informative">
        <h3>
          Implementation considerations
        </h3>
        <p>
          Implementers are advised to consider the following aspects that can
          negatively affect the privacy of their users: in certain cases, users
          can inadvertently grant permission to the user agent to disclose
          their location to websites. In other cases, the content hosted at a
          certain URL changes in such a way that the previously granted
          location permissions no longer apply as far as the user is concerned.
          Or the users might simply change their minds.
        </p>
        <p>
          Predicting or preventing these situations is inherently difficult.
          Mitigation and in-depth defensive measures are an implementation
          responsibility and not prescribed by this specification. However, in
          designing these measures, implementers are advised to enable user
          awareness of location sharing, and to provide easy access to
          interfaces that enable revocation of permissions.
        </p>
      </section>
    </section>
    <section id="navigator_interface" data-dfn-for="Navigator">
      <h2>
        Extensions to the `Navigator` interface
      </h2>
      <pre class="idl">
        partial interface Navigator {
          [SameObject] readonly attribute Geolocation geolocation;
        };
      </pre>
    </section>
    <section id="geolocation_interface" data-dfn-for="Geolocation">
      <h2>
        `Geolocation` interface and callbacks
      </h2>
      <pre class="idl">
        [Exposed=Window]
        interface Geolocation {
          undefined getCurrentPosition (
            PositionCallback successCallback,
            optional PositionErrorCallback? errorCallback = null,
            optional PositionOptions options = {}
          );

          long watchPosition (
            PositionCallback successCallback,
            optional PositionErrorCallback? errorCallback = null,
            optional PositionOptions options = {}
          );

          undefined clearWatch (long watchId);
        };

        callback PositionCallback = undefined (
          GeolocationPosition position
        );

        callback PositionErrorCallback = undefined (
          GeolocationPositionError positionError
        );
      </pre>
      <section>
        <h2>
          Internal Slots
        </h2>
        <p>
          Instances of {{Geolocation}} are created with the internal slots in
          the following table:
        </p>
        <table class="data">
          <tr>
            <th>
              Internal Slot
            </th>
            <th>
              Description
            </th>
          </tr>
          <tr>
            <td>
              <dfn data-dfn-for="Geolocation">[[\cache]]</dfn>
            </td>
            <td>
              Initialized as an [=ordered map=], with {{DOMTimeStamp}} as keys
              and {{GeolocationPosition}} instances as values. Expiration of
              cached key/value pairs is left as an implementation detail.
            </td>
          </tr>
          <tr>
            <td>
              <dfn data-dfn-for="Geolocation">[[\watchTasks]]</dfn>
            </td>
            <td>
              Initialized as an [=set=], with {{unsigned long}} for the keys
              representing the id of a timed task.
            </td>
          </tr>
        </table>
      </section>
      <section>
        <h2>
          `getCurrentPosition()` method
        </h2>
        <p data-tests=
        "getCurrentPosition_IDL.https.html, getCurrentPosition_TypeError.html">
          When {{Geolocation/getCurrentPosition()}} is invoked, the user agent
          MUST:
        </p>
        <ol class="algorithm">
          <li>[=Request position=], passing |successCallback|, |errorCallback|,
          |options|, and (repeats) false.
          </li>
          <li>Return `undefined`.
          </li>
        </ol>
      </section>
      <section>
        <h2>
          `watchPosition()` method
        </h2>
        <p data-tests=
        "getCurrentPosition_permission_allow.https.html, getCurrentPosition_permission_deny.https.html">
          When <dfn>watchPosition()</dfn> is invoked, the user agent MUST:
        </p>
        <ol class="algorithm">
          <li>Let |watchId:long| be [=request position=], passing
          |successCallback|, |errorCallback|, |options|, and (repeats) true.
          </li>
          <li>Return |watchId|.
          </li>
        </ol>
      </section>
      <section>
        <h2>
          `clearWatch()` method
        </h2>
        <p data-tests="clearWatch_TypeError.html">
          When <dfn>clearWatch()</dfn> is invoked, the user agent MUST:
        </p>
        <ol class="algorithm">
          <li>If [=this=]'s {{Geolocation/[[watchTasks]]}}[|watchId|]
          [=map/exists=], [=map/remove=] [=this=]'s
          {{Geolocation/[[watchTasks]]}}[|watchId|].
          </li>
        </ol>
      </section>
      <section>
        <h2>
          Request position
        </h2>
        <p>
          <dfn>Request position</dfn> by passing a {{PositionCallback}}
          |successCallback:PositionCallback|, a {{PositionErrorCallback}}
          |errorCallback:PositionErrorCallback|`?`, {{PositionOptions}}
          |options:PositionOptions|, a {{boolean}} |repeats:boolean|, and
          optionally (and only if |repeats| is true) a |previous id:long|.
        </p>
        <ol class="algorithm">
          <li>Let |cache:Ordered map| be [=this=]'s {{Geolocation/[[cache]]}}.
          </li>
          <li>Let |watchTasks:Set| be [=this=]'s
          {{Geolocation/[[watchTasks]]}}.
          </li>
          <li>Acquire a watch id.
            <ol>
              <li>If |previous id| was provided and |repeats| is true, let
              |watchId| be |previous id|; Otherwise, let |watchId| be an
              [=implementation-defined=] {{long}} that is greater than or equal
              to zero.
              </li>
              <li>[=Set/Append=] |watchId| to |watchTasks|.
              </li>
              <li>Return |watchId| and continue [=in parallel=].
              </li>
            </ol>
          </li>
          <li data-cite="page-visibility-2">Wait for document to become
          visible.
            <ol>
              <li>Let |document:Document| be the [=current settings object=]'s
              [=associated Document=].
              </li>
              <li>If |document:Document| is [=Document/hidden=], wait for the
              |document| to become [=Document/visible=].
              </li>
            </ol>
          </li>
          <li data-tests=
          "getCurrentPosition_permission_allow.https.html, getCurrentPosition_permission_deny.https.html">
          [=Do security and permissions checks=] passing |errorCallback|.
          </li>
          <li>If the checks return failure:
            <ol>
              <li>[=List/Remove=] |watchId| from |watchTasks|.
              </li>
              <li>Terminate this algorithm.
              </li>
            </ol>
          </li>
          <li>Acquire position.
            <ol>
              <li>Let |acquisitionTime| be a new {{DOMTimeStamp}} that
              represents now.
              </li>
              <li>Let |keys| be [=map/get the keys=] from |cache|.
              </li>
              <li>For each |key| in |keys| in reverse order (i.e., from
              freshes):
                <ol>
                  <li>If |key| is no greater than the value of the
                  |options|.{{PositionOptions/maximumAge}} member:
                    <ol>
                      <li>[=Queue a microtask=] to invoke |successCallback|
                      with |cache|[|key|];
                      </li>
                      <li>Go to <a href="#check-repeats">determine
                      repetition</a> steps below.
                      </li>
                    </ol>
                  </li>
                </ol>
              </li>
              <li>Let |timeout| be a new timed [=task=] that runs in
              |options|.{{PositionOptions/timeout}} milliseconds after
              |acquisitionTime|, which performs the following sub-steps:
                <aside class="note" title="Immediate cancellation">
                  <p>
                    A |options|.{{PositionOptions/timeout}} value 0 effectively
                    runs the |timeout| task immediately.
                  </p>
                </aside>
                <ol>
                  <li>If the entry for |timerId| in the [=list of active
                  timers=] has been cleared, then abort these steps.
                  </li>
                  <li>[=Call back with error=] with |errorCallback| and
                  {{GeolocationPositionError/TIMEOUT}}.
                  </li>
                </ol>
              </li>
              <li>Let |timerId| be an [=implementation-defined=] identifier
              that represents |timeout|.
              </li>
              <li>Add |timerId| to the [=list of active timers=].
              </li>
              <li>Try to acquire the device's position, optionally taking into
              consideration the value of
              |options|.{{PositionOptions/enableHighAccuracy}}:
                <ol>
                  <li>If acquiring a position succeeds:
                    <ol>
                      <li>Let |position| be [=a new `GeolocationPosition`=].
                      </li>
                      <li>[=Map/Set=] |cache|[acquisitionTime] to |position|.
                      </li>
                      <li>[=Queue a microtask=] to [=invoke=] |successCallback|
                      with |position|.
                      </li>
                    </ol>
                  </li>
                  <li>If acquiring a position fails:
                    <ol>
                      <li>[=Call back with error=] passing |errorCallback| and
                      {{GeolocationPositionError/POSITION_UNAVAILABLE}}.
                      </li>
                    </ol>
                  </li>
                </ol>
              </li>
              <li>Clear |timerId| from the [=list of active timers=].
              </li>
            </ol>
          </li>
          <li>
            <span id="check-repeats">Determine repetition</span>.
            <ol>
              <li>If |repeats| is false:
                <ol>
                  <li>[=List/Remove=] |watchId| from |watchTasks|.
                  </li>
                  <li>Terminate this algorithm.
                  </li>
                </ol>
              </li>
            </ol>
          </li>
          <li>Wait for a significant change of position. What constitutes a
          significant change in position is left to the implementation. A user
          agents MAY impose a rate limit on the frequency position changes.
            <ol>
              <li>Let |position:GeolocationPosition| be a [=a new
              `GeolocationPosition`=].
              </li>
              <li>[=Map/Set=] |cache|[acquisitionTime] to |position|.
              </li>
            </ol>
          </li>
          <li>If |watchTasks| [=list/contain|contains=] |watchId|, [=request
          position=] passing |successCallback|, |errorCallback|, |options|,
          |repeats|, and |watchId|.
          </li>
        </ol>
      </section>
      <section>
        <h2>
          Security and permissions checks
        </h2>
        <p>
          When instructed to <dfn>do security and permissions checks</dfn>,
          given an {{PositionErrorCallback}}`?`
          |errorCallback:PositionErrorCallback|:
        </p>
        <ol>
          <li>If the <a>environment settings object</a> is a <a data-cite=
          "secure-contexts">non-secure context</a>, then:
            <ol>
              <li>[=Call back with error=] |errorCallback| and
              {{GeolocationPositionError/PERMISSION_DENIED}}.
              </li>
              <li>Return failure.
              </li>
            </ol>
          </li>
          <li>Let |permission:PermissionState| be [=request permission to use=]
          "geolocation".
          </li>
          <li data-cite="permissions">If |permission| is
          {{PermissionState/"denied"}}, then:
            <ol>
              <li>[=Call back with error=] |errorCallback| and
              {{GeolocationPositionError/PERMISSION_DENIED}}.
              </li>
              <li>Return failure.
              </li>
            </ol>
          </li>
        </ol>
      </section>
      <section>
        <h2>
          Call back with error
        </h2>
        <p>
          When instructed to <dfn>call back with error</dfn>, given an
          {{PositionErrorCallback}}`?` |callback:PositionErrorCallback| and an
          {{unsigned short}} |code:unsigned short|:
        </p>
        <ol class="algorithm">
          <li>If |callback| is null, return.
          </li>
          <li>Let |error| be a a newly created {{GeolocationPositionError}}
          instance whose {{GeolocationPositionError/code}} attribute is
          initialized to |code|.
          </li>
          <li>[=Invoke=] |callback| with |error|.
          </li>
        </ol>
      </section>
    </section>
    <section id="position_options_interface" data-dfn-for="PositionOptions">
      <h2>
        <dfn>PositionOptions</dfn> dictionary
      </h2>
      <pre class="idl">
        dictionary PositionOptions {
          boolean enableHighAccuracy = false;
          [Clamp] unsigned long timeout = 0xFFFFFFFF;
          [Clamp] unsigned long maximumAge = 0;
        };
        </pre>
      <section>
        <h2>
          `enableHighAccuracy` member
        </h2>
        <p data-tests="PositionOptions.https.html">
          The <dfn>enableHighAccuracy</dfn> member provides a hint that the
          application would like to receive the best possible results. This MAY
          result in slower response times or increased power consumption. The
          user might also disable this capability, or the device might not be
          able to provide more accurate results than if the flag wasn't
          specified. The intended purpose of this member is to allow
          applications to inform the implementation that they do not require
          high accuracy geolocation fixes and, therefore, the implementation
          can avoid using geolocation providers that consume a significant
          amount of power (e.g. GPS). This is especially useful for
          applications running on battery-powered devices.
        </p>
      </section>
      <section>
        <h2>
          `timeout` member
        </h2>
        <p data-tests="PositionOptions.https.html">
          The <dfn>timeout</dfn> member denotes the maximum length of time,
          expressed in milliseconds, before acquiring a position expires. Note
          that the time spent waiting for the document to become visible and
          for [=Do security and permissions checks|obtaining the user
          permission=] is not included in the period covered by the
          {{PositionOptions/timeout}} member. The {{PositionOptions/timeout}}
          member only applies to the location acquisition operation.
        </p>
      </section>
      <section>
        <h2>
          `maximumAge` member
        </h2>
        <p data-tests="PositionOptions.https.html">
          The <dfn>maximumAge</dfn> member indicates that the web application
          is willing to accept a cached position whose age is no greater than
          the specified time in milliseconds.
        </p>
      </section>
    </section>
    <section id="position_interface" data-dfn-for="GeolocationPosition">
      <h2>
        `GeolocationPosition` interface
      </h2>
      <pre class="idl">
        [Exposed=Window, SecureContext]
        interface GeolocationPosition {
          readonly attribute GeolocationCoordinates coords;
          readonly attribute DOMTimeStamp timestamp;
        };
      </pre>
      <section>
        <h4>
          `coords` attribute
        </h4>
        <p>
          The <dfn>coords</dfn> attribute contains a set of geographic
          coordinates.
        </p>
      </section>
      <section>
        <h4>
          `timestamp` attribute
        </h4>
        <p>
          The <dfn>timestamp</dfn> attribute represents the time when the
          geographic position of the device was acquired.
        </p>
      </section>
    </section>
    <section id="coordinates_interface" data-dfn-for="GeolocationCoordinates">
      <h2>
        <dfn>GeolocationCoordinates</dfn> interface
      </h2>
      <pre class="idl">
        [Exposed=Window, SecureContext]
        interface GeolocationCoordinates {
          readonly attribute double accuracy;
          readonly attribute double latitude;
          readonly attribute double longitude;
          readonly attribute double? altitude;
          readonly attribute double? altitudeAccuracy;
          readonly attribute double? heading;
          readonly attribute double? speed;
        };
        </pre>
      <p>
        The geographic coordinate reference system used by the attributes in
        this interface is the World Geodetic System (2d) [[WGS84]]. No other
        reference system is supported.
      </p>
      <section>
        <h4>
          `latitude` and `longitude`, and `accuracy` attributes
        </h4>
        <p>
          The <dfn>latitude</dfn> and <dfn>longitude</dfn> attributes are
          geographic coordinates specified in decimal degrees.
        </p>
        <p>
          The <dfn>accuracy</dfn> attribute denotes the accuracy level of the
          latitude and longitude coordinates in meters.
        </p>
      </section>
      <section>
        <h4>
          `altitude` and `altitudeAccuracy` attributes
        </h4>
        <p>
          The <dfn>altitude</dfn> attribute denotes the height of the position,
          specified in meters above the [[WGS84]] ellipsoid.
        </p>
        <p>
          The <dfn>altitudeAccuracy</dfn> attribute represents the altitude
          accuracy in meters.
        </p>
      </section>
      <section>
        <h4>
          `heading` attribute
        </h4>
        <p>
          The <dfn>heading</dfn> attribute denotes the direction of travel of
          the hosting device and is specified in degrees, where 0° ≤ heading
          &lt; 360°, counting clockwise relative to the true north.
        </p>
      </section>
      <section>
        <h4>
          `speed` attribute
        </h4>
        <p>
          The <dfn>speed</dfn> attribute denotes the magnitude of the
          horizontal component of the hosting device's current velocity in
          meters per second.
        </p>
      </section>
      <section>
        <h2>
          Constructing a `GeolocationPosition`
        </h2>
        <p>
          <dfn>A new `GeolocationPosition`</dfn> is constructed with {{unsigned
          long}} |timestamp:unsigned long| by performing the following steps:
        </p>
        <ol class="algorithm">
          <li>Let |coords| be a newly created {{GeolocationCoordinates}}
          instance:
            <ol>
              <li>Initialize |coord|'s {{GeolocationCoordinates/latitude}}
              attribute to a geographic coordinate in decimal degrees.
              </li>
              <li>Initialize |coord|'s {{GeolocationCoordinates/longitude}}
              attribute to a geographic coordinate in decimal degrees.
              </li>
              <li>Initialize |coord|'s {{GeolocationCoordinates/accuracy}}
              attribute to a non-negative real number. The value SHOULD
              correspond to a 95% confidence level with respect to the
              longitude and latitude values.
              </li>
              <li>Initialize |coord|'s {{GeolocationCoordinates/altitude}}
              attribute in meters above the [[WGS84]] ellipsoid, or `null` if
              the implementation cannot provide altitude information.
              </li>
              <li>Initialize |coord|'s
              {{GeolocationCoordinates/altitudeAccuracy}} attribute as
              non-negative real number, or to `null` if the implementation
              cannot provide altitude information. If the altitude accuracy
              information is provided, it SHOULD correspond to a 95% confidence
              level.
              </li>
              <li>Initialize |coord|'s {{GeolocationCoordinates/speed}}
              attribute to a non-negative real number, or as `null` if the
              implementation cannot provide speed information.
              </li>
              <li>Initialize |coord|'s {{GeolocationCoordinates/heading}}
              attribute in degrees, or `null` implementation cannot provide
              heading information. If the hosting device is stationary (i.e.
              the value of the {{GeolocationCoordinates/speed}} attribute is
              0), then initialize the {{GeolocationCoordinates/heading}} to
              `NaN`.
              </li>
            </ol>
          </li>
          <li>Return a newly created {{GeolocationPosition}} instance with its
          {{GeolocationPosition/coords}} attribute initialized to |coords| and
          {{GeolocationPosition/timestamp}} attribute initialized to
          |timestamp|.
          </li>
        </ol>
      </section>
    </section>
    <section id="position_error_interface" data-dfn-for=
    "GeolocationPositionError">
      <h2>
        <dfn>GeolocationPositionError</dfn> interface
      </h2>
      <pre class="idl">
        [Exposed=Window]
        interface GeolocationPositionError {
          const unsigned short PERMISSION_DENIED = 1;
          const unsigned short POSITION_UNAVAILABLE = 2;
          const unsigned short TIMEOUT = 3;
          readonly attribute unsigned short code;
          readonly attribute DOMString message;
        };
        </pre>
      <section id="constants">
        <h3>
          Constants
        </h3>
        <dl>
          <dt>
            <dfn>PERMISSION_DENIED</dfn> (numeric value 1)
          </dt>
          <dd>
            The location acquisition process failed because the document does
            not have permission to use the Geolocation API.
          </dd>
          <dt>
            <dfn>POSITION_UNAVAILABLE</dfn> (numeric value 2)
          </dt>
          <dd>
            The position of the device could not be determined. For instance,
            one or more of the location providers used in the location
            acquisition process reported an internal error that caused the
            process to fail entirely.
          </dd>
          <dt>
            <dfn>TIMEOUT</dfn> (numeric value 3)
          </dt>
          <dd>
            The length of time specified by the {{PositionOptions/timeout}}
            property has elapsed before the implementation could successfully
            acquire a new {{GeolocationPosition}} object.
          </dd>
        </dl>
      </section>
      <section>
        <h4>
          `code` attribute
        </h4>
        <p>
          The <dfn>code</dfn> attribute returns the value it was initialized to
          (see [[[#constants]]]).
        </p>
      </section>
      <section>
        <h4>
          `message` attribute
        </h4>
        <p>
          The <dfn>message</dfn> attribute is a developer-friendly textual
          description of the {{GeolocationPositionError/code}} attribute.
        </p>
        <p class="note" title="Don't show .message to users!">
          The purpose of the {{GeolocationPositionError/message}} attribute is
          to assist with debugging - as such, they probably won't make any
          sense if shown to an end user. Please use the
          {{GeolocationPositionError}}'s {{GeolocationPositionError/code}}
          attribute to create user-friendly localized error messages.
        </p>
      </section>
    </section>
    <section>
      <h2>
        Permissions policy
      </h2>
      <p>
        The <cite>Geolocation API</cite> defines a [=policy-controlled
        feature=] identified by the string "geolocation". Its [=default
        allowlist=] is `["self"]`.
      </p>
    </section>
    <section id="usecases" class="appendix informative">
      <h2>
        Use cases
      </h2>
      <section id="usecase_find_poi">
        <h3>
          Find points of interest in the user's area
        </h3>
        <p>
          Someone visiting a foreign city could access a Web application that
          allows users to search or browse through a database of tourist
          attractions. Using the Geolocation API, the Web application has
          access to the user's approximate position and it is therefore able to
          rank the search results by proximity to the user's location.
        </p>
      </section>
      <section id="usecase_content_annotation">
        <h3>
          Annotating content with location information
        </h3>
        <p>
          A group of friends is hiking through the Scottish highlands. Some of
          them write short notes and take pictures at various points throughout
          the journey and store them using a Web application that can work
          offline on their hand-held devices. Whenever they add new content,
          the application automatically tags it with location data from the
          Geolocation API (which, in turn, uses the on-board GPS device). Every
          time they reach a town or a village, and they are again within
          network coverage, the application automatically uploads their notes
          and pictures to a popular blogging website, which uses the
          geolocation data to construct links that point to a mapping service.
          Users who follow the group's trip can click on these links to see a
          satellite view of the area where the notes were written and the
          pictures were taken. Another example is a life blog where a user
          creates content (e.g. images, video, audio) that records her every
          day experiences. This content can be automatically annotated with
          information such as time, geographic position or even the user's
          emotional state at the time of the recording.
        </p>
      </section>
      <section id="usecase_show_position">
        <h3>
          Show the user's position on a map
        </h3>
        <p>
          A user finds themselves in an unfamiliar city area. They want to
          check their position so they use their device to navigate to a
          mapping application that can pinpoint their location on the city map
          using the Geolocation API. The user then asks the Web application to
          provide driving directions from their current position to a different
          destination.
        </p>
      </section>
      <section id="usecase_turn_by_turn">
        <h3>
          Turn-by-turn route navigation
        </h3>
        <p>
          A mapping application can help the user navigate along a route by
          providing detailed turn-by-turn directions. The application does this
          by registering with the Geolocation API to receive repeated location
          updates of the user's position. These updates are delivered as soon
          as the implementing user agent determines that the position of the
          user has changed, which allows the application to anticipate any
          changes of direction that the user might need to do.
        </p>
      </section>
      <section id="usecase_local_info">
        <h3>
          Up-to-date local information
        </h3>
        <p>
          A widget-like Web application that shows the weather or news that are
          relevant to the user's current area can use the Geolocation API to
          register for location updates. If the user's position changes, the
          widget can adapt the content accordingly.
        </p>
      </section>
      <section id="usecase_social_networking">
        <h3>
          Location-tagged status updates in social networking applications
        </h3>
        <p>
          A social network application allows its users to automatically tag
          their status updates with location information. It does this by
          monitoring the user's position with the Geolocation API. Each user
          can control the granularity of the location information (e.g. city or
          neighborhood level) that is shared with the other users. Any user can
          also track their network of friends and get real-time updates about
          their current location.
        </p>
      </section>
    </section>
    <section id="conformance"></section>
    <section id="idl-index" class="appendix">
      <!-- All the Web IDL will magically appear here -->
    </section>
    <section class="appendix" id="index"></section>
    <section class="appendix informative">
      <h2>
        Acknowledgments
      </h2>
      <p>
        The Geolocation API in this specification builds upon earlier work in
        the industry, including research by Aza Raskin, Google Gears
        Geolocation API, and LocationAware.org.
      </p>
      <p>
        Thanks also to Alec Berntson, Alissa Cooper, Steve Block, Greg
        Bolsinga, Lars Erik Bolstad, Aaron Boodman, Dave Burke, Chris Butler,
        Max Froumentin, Shyam Habarakada, Marcin Hanclik, Ian Hickson, Brad
        Lassey, Angel Machin, Cameron McCormack, Daniel Park, Stuart Parmenter,
        Olli Pettay, Chris Prince, Arun Ranganathan, Carl Reed, Thomas
        Roessler, Dirk Segers, Allan Thomson, Martin Thomson, Doug Turner, Erik
        Wilde, Matt Womer, and Mohamed Zergaoui.
      </p>
    </section>
  </body>
</html>
